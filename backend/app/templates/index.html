<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Insuretech MVP Control Panel</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: "Segoe UI", Roboto, sans-serif;
      }
      body {
        margin: 0;
        background: #f5f5f5;
        color: #222;
      }
      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 2.5rem 1.5rem 4rem;
      }
      h1 {
        font-size: 2.3rem;
        margin-bottom: 0.5rem;
        text-align: center;
      }
      p.tagline {
        text-align: center;
        margin-top: 0;
        color: #555;
      }
      section {
        background: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        margin-top: 1.5rem;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      }
      section h2 {
        margin-top: 0;
        margin-bottom: 0.75rem;
      }
      form {
        display: grid;
        gap: 0.75rem;
      }
      label {
        font-size: 0.9rem;
        color: #374151;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }
      input,
      textarea,
      select {
        font: inherit;
        padding: 0.6rem 0.7rem;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        background: #f9fafb;
      }
      textarea {
        min-height: 120px;
      }
      button {
        justify-self: start;
        padding: 0.6rem 1.25rem;
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 999px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
      }
      button:hover {
        background: #1d4ed8;
      }
      pre {
        background: #111827;
        color: #f9fafb;
        padding: 1rem;
        border-radius: 10px;
        overflow-x: auto;
        font-size: 0.85rem;
        line-height: 1.4;
      }
      .grid {
        display: grid;
        gap: 1.5rem;
      }
      @media (min-width: 880px) {
        .grid.two {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
      .status {
        margin-top: 1rem;
        font-size: 0.9rem;
        color: #065f46;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Insuretech MVP Control Panel</h1>
      <p class="tagline">
        Try quoting, underwriting, claims summarisation, chatbot and fraud scoring from one lightweight UI.
      </p>

      <section>
        <h2>API Health</h2>
        <button type="button" id="health-check">Run health check</button>
        <div class="status" id="health-status"></div>
      </section>

      <section>
        <h2>Quote a policy</h2>
        <form id="quote-form">
          <div class="grid two">
            <label>Customer ID<input name="customer_id" value="cust-001" required /></label>
            <label>Age<input type="number" name="age" value="35" min="18" required /></label>
            <label>Vehicle value<input type="number" name="vehicle_value" value="20000" step="500" required /></label>
            <label>Prior claims<input type="number" name="prior_claims" value="0" min="0" required /></label>
            <label>Credit score<input type="number" name="credit_score" value="680" min="350" max="900" required /></label>
            <label>
              Gender
              <select name="gender">
                <option value="F">Female</option>
                <option value="M">Male</option>
                <option value="X">Other</option>
              </select>
            </label>
          </div>
          <button type="submit">Calculate quote</button>
        </form>
        <pre id="quote-output">Awaiting input…</pre>
      </section>

      <section>
        <h2>Underwriting check</h2>
        <form id="underwrite-form">
          <div class="grid two">
            <label>Customer ID<input name="customer_id" value="cust-001" required /></label>
            <label>Age<input type="number" name="age" value="35" min="18" required /></label>
            <label>Vehicle value<input type="number" name="vehicle_value" value="20000" step="500" required /></label>
            <label>Prior claims<input type="number" name="prior_claims" value="0" min="0" required /></label>
            <label>Credit score<input type="number" name="credit_score" value="680" min="350" max="900" required /></label>
            <label>Income<input type="number" name="income" value="95000" step="1000" required /></label>
          </div>
          <button type="submit">Run underwriting</button>
        </form>
        <pre id="underwrite-output">Awaiting input…</pre>
      </section>

      <section>
        <h2>Claims summarisation</h2>
        <form id="claims-form">
          <label>
            Describe the claim
            <textarea name="description" placeholder="Describe the incident…" required>Minor fender bender, no injuries, damage to rear bumper.</textarea>
          </label>
          <button type="submit">Summarise claim</button>
        </form>
        <pre id="claims-output">Awaiting input…</pre>
      </section>

      <section>
        <h2>Chat with the assistant</h2>
        <form id="chat-form">
          <label>
            Message
            <textarea name="message" placeholder="Ask a question about your policy" required>Hello! Can you explain my deductible?</textarea>
          </label>
          <button type="submit">Send</button>
        </form>
        <pre id="chat-output">Awaiting input…</pre>
      </section>

      <section>
        <h2>Fraud risk quick check</h2>
        <form id="fraud-form">
          <label>
            Claim amount (USD)
            <input type="number" name="amount" value="5000" min="0" step="100" required />
          </label>
          <button type="submit">Score risk</button>
        </form>
        <pre id="fraud-output">Awaiting input…</pre>
      </section>

      <section>
        <h2>Recent observability logs</h2>
        <button type="button" id="refresh-logs">Refresh logs</button>
        <pre id="logs-output">No data yet.</pre>
      </section>
    </main>
    <script>
      function formToJSON(form) {
        const data = new FormData(form);
        return Object.fromEntries(data.entries());
      }

      async function submitJSON(url, payload, output) {
        output.textContent = "Loading…";
        try {
          const res = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const json = await res.json();
          output.textContent = JSON.stringify(json, null, 2);
        } catch (err) {
          output.textContent = `Request failed: ${err}`;
        }
      }

      document.getElementById("quote-form").addEventListener("submit", (evt) => {
        evt.preventDefault();
        const payload = formToJSON(evt.target);
        payload.age = Number(payload.age);
        payload.vehicle_value = Number(payload.vehicle_value);
        payload.prior_claims = Number(payload.prior_claims);
        payload.credit_score = Number(payload.credit_score);
        submitJSON("/quote", payload, document.getElementById("quote-output"));
      });

      document.getElementById("underwrite-form").addEventListener("submit", (evt) => {
        evt.preventDefault();
        const payload = formToJSON(evt.target);
        payload.age = Number(payload.age);
        payload.vehicle_value = Number(payload.vehicle_value);
        payload.prior_claims = Number(payload.prior_claims);
        payload.credit_score = Number(payload.credit_score);
        payload.income = Number(payload.income);
        submitJSON("/underwrite", payload, document.getElementById("underwrite-output"));
      });

      document.getElementById("claims-form").addEventListener("submit", (evt) => {
        evt.preventDefault();
        const payload = formToJSON(evt.target);
        submitJSON("/claims", payload, document.getElementById("claims-output"));
      });

      document.getElementById("chat-form").addEventListener("submit", (evt) => {
        evt.preventDefault();
        const payload = formToJSON(evt.target);
        submitJSON("/chat", payload, document.getElementById("chat-output"));
      });

      document.getElementById("fraud-form").addEventListener("submit", async (evt) => {
        evt.preventDefault();
        const params = new URLSearchParams({ amount: evt.target.amount.value });
        const output = document.getElementById("fraud-output");
        output.textContent = "Loading…";
        try {
          const res = await fetch(`/fraud/score?${params}`);
          const json = await res.json();
          output.textContent = JSON.stringify(json, null, 2);
        } catch (err) {
          output.textContent = `Request failed: ${err}`;
        }
      });

      async function refreshLogs() {
        const output = document.getElementById("logs-output");
        output.textContent = "Loading…";
        try {
          const res = await fetch("/logs?limit=10");
          const json = await res.json();
          output.textContent = JSON.stringify(json, null, 2);
        } catch (err) {
          output.textContent = `Request failed: ${err}`;
        }
      }

      document.getElementById("refresh-logs").addEventListener("click", refreshLogs);

      document.getElementById("health-check").addEventListener("click", async () => {
        const status = document.getElementById("health-status");
        status.textContent = "Checking…";
        try {
          const res = await fetch("/health");
          const json = await res.json();
          status.textContent = `API status: ${json.status}`;
        } catch (err) {
          status.textContent = `Request failed: ${err}`;
        }
      });

      refreshLogs();
    </script>
  </body>
</html>
